{{- define "workload.serviceAccount" -}}
{{- $service_accounts := default (dict) .serviceAccounts }}
{{- $name_override := default "" .nameOverride }}
{{- $params := list }}
{{- range $name, $config := $service_accounts }}
  {{- if $name_override }}
    {{- $name = $name_override }}
  {{- end }}
  {{- $_ := set $config "name" $name }}
  {{- $params = append $params $config }}
{{- end }}
{{- $params := mergeOverwrite (. | deepCopy) (dict "serviceAccounts" $params) }}
{{- include "mozcloud-workload-core-lib.serviceAccount" $params }}
{{- end -}}
