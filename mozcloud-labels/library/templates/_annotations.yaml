{{- define "mozcloud-labels-lib.annotations" -}}
{{- if and .otel (eq (.type) "pod") -}}
{{- include "mozcloud-labels-lib.annotations.otel" . }}
{{- end }}
{{- if .annotations }}
{{ .annotations | toYaml }}
{{- end }}
{{- end -}}

{{- /* OTEL annotations */ -}}
{{- define "mozcloud-labels-lib.annotations.otel.fields" -}}
{{- $labels := include "mozcloud-labels-lib.labels" . | fromYaml -}}
app_code: {{ $labels.app_code }}
component_code: {{ $labels.component_code }}
env_code: {{ $labels.env_code }}
realm: {{ $labels.realm }}
{{- end -}}

{{- define "mozcloud-labels-lib.annotations.otel" -}}
{{- $fields := include "mozcloud-labels-lib.annotations.otel.fields" . | fromYaml -}}
{{- range $name, $value := $fields }}
resource.opentelemetry.io/{{ $name }}: {{ $value }}
{{- end }}
{{- end -}}
