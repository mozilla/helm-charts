{{- define "mozcloud-labels-lib.labels" -}}
{{- /* We do not need the full context here */ -}}
{{- $context := dict "app_code" .app_code "component_code" .component_code "env_code" .env_code  -}}
{{- $chart := "" }}
{{- if .chart }}
  {{- $chart = .chart }}
{{- else if (.Chart).Name }}
  {{- $chart = .Chart.Name }}
{{- else if (.Chart).name }}
  {{- $chart = .Chart.name }}
{{- end }}
{{- if $chart }}
  {{- $_ := set $context "chart" $chart -}}
{{- end }}
{{- $additional_labels := include "mozcloud-labels-lib.additional_labels" $context | fromYaml -}}
{{- $kubernetes_labels := include "mozcloud-labels-lib.kubernetes_labels" $context | fromYaml -}}
{{- $merged_labels := mergeOverwrite $kubernetes_labels $additional_labels -}}
{{ $merged_labels | toYaml }}
{{- end -}}

{{- define "mozcloud-labels-lib.additional_labels" -}}
app_code: {{ .app_code }}
component_code: {{ .component_code }}
env_code: {{ .env_code }}
{{- if eq .env_code "prod" }}
realm: prod
{{- else }}
realm: nonprod
{{- end }}
{{- end -}}

{{- define "mozcloud-labels-lib.kubernetes_labels" -}}
app.kubernetes.io/name: {{ .app_code }}
app.kubernetes.io/component: {{ .component_code }}
app.kubernetes.io/managed-by: argocd
{{- if .appVersion }}
app.kubernetes.io/version: {{ .appVersion | quote }}
{{- end }}
{{- if .chart }}
helm.sh/chart: {{ .chart }}
{{- end }}
{{- end -}}
