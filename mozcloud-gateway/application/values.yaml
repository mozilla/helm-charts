# If disabled, no resources in the chart will be created.
enabled: true

# Name to be used for all resources if not specified at the resource level.
# This should match the name of the parent Helm chart.
#nameOverride:

# Application code. This should match the `app_code` value in your tenant's
# values.yaml file.
#appCode:

# Component. This should match the `component` value in your tenant's
# values.yaml file.
#component:

# Environment. This should match the `environment` value in your tenant's
# values-<env>.yaml file.
#environment:

# TODO: Create backend policies
# Defines how the backend services of the load balancer should distribute the
# traffic to the endpoints. This policy is similar to a BackendConfig for an
# Ingress resource.
backendPolicies: []

# TODO: Create backend services
# Defines the backend services to create and their configurations.
backendServices: []

# Defines the Gateways to create and their configurations.
gateway:
  # If disabled, Gateway resources will not be created in the K8s namespace.
  enabled: false

  gateways:
    - name: mozcloud-gateway

      # Type can be "internal" or "external". The library chart will
      # automatically assign the preferred className if not defined here.
      # Overridden by "className", if defined.
      #
      # Read more: https://cloud.google.com/kubernetes-engine/docs/concepts/gateway-api#gatewayclass
      #
      # Note: Internal and external gateways MUST be created separately.
      type: external

      # Sets the load balancer scope. Options are "global" or "regional".
      #
      # External gateways can be either "global" (default) or "regional".
      # Internal gateways can only be "regional".
      #
      # Overridden by "className", if defined.
      #scope: global

      # Manually define a className, if desired. By default, the following
      # classNames will be assigned for each respective gateway type:
      #
      #   internal: gke-l7-rilb
      #   external: gke-l7-global-external-managed
      #
      # This will override "type" and "scope" configurations.
      #className: gke-l7-global-external-managed

      # A list of the named addresses to use on the Gateway. These should match
      # the named addresses created for the tenant in GCP.
      addresses:
        - mozcloud-gateway-dev-ip-v4

      certificates:
        # A list of the certmap, pre-shared cert, or secret names to use on the
        # gateway.
        #
        # Certificate maps and pre-shared certificates are created
        # outside of Kubernetes either by tenant Terraform modules (certmaps)
        # or manually (pre-shared).
        #
        # Secrets can be created via Certificate resources provisioned by
        # cert-manager.
        names:
          - my-certmap

        # Can be "certmap", "pre-shared", or "secret". Default (and preferred)
        # is "certmap".
        type: certmap

      listeners:
        # The http listener will be created by default to handle HTTP to HTTPS
        # redirects.
        - name: http
          protocol: HTTP
          port: 80

        # The https listener is used to handle inbound traffic to the service.
        # Inbound gateways do not need https listeners.
        - name: https
          protocol: HTTPS
          port: 443

# TODO: Create gateway policies
# Defines specific parameters of the frontend of the Google Cloud load
# balancer. This policy is similar to a FrontendConfig for an Ingress resource.
gatewayPolicies: []

# TODO: Create health check policies
# Defines the parameters and behavior of the health check used to check the
# health status of the backend Pods.
healthCheckPolicies: []

# TODO: Create HTTP Routes
# Defines how HTTP and HTTPS requests received by a Gateway are directed to
# Services.
httpRoute:
  # If disabled, HTTPRoute resources will not be created in the K8s namespace.
  enabled: false

  httpRoutes:
    - name: mozcloud-gateway

      # Hostnames to match against. Hostnames are matched before any other
      # matches (path, headers) occur.
      hostnames:
        - chart.example.local
        - chart2.example.local

      # If enabled, create an HTTP-to-HTTPS redirect.
      #httpToHttpsRedirect: true

      # Define parent Gateway resource the HTTPRoute should attach to.
      parentRefs:
        - kind: Gateway
          name: mozcloud-gateway

          # This refers to the name of the listener to use on the gateway. See
          # gateway.gateways[].listeners[].name for Gateways created using this
          # chart.
          section: https

      rules:
          # A list of the backend services to receive traffic.
        - backendRefs:
              # The name of the backend service
            - name: mozcloud-gateway
              port: 8080

              # The amount of inbound traffic you want send to this backend
              # service. This value creates a percentage of the total weights
              # specified across all backend services in this rule.
              #
              # For example, say you have the following backend services
              # specified:
              #
              #   - name: service1
              #     port: 8080
              #     weight: 3
              #   - name: service2
              #     port: 8080
              #     weight: 1
              #
              # In this example, "service1" would receive roughly 75% of
              # requests and "service2" would receive roughly 25%.
              #
              # If unspecified, each backend service will be assigned a weight
              # of 1.
              #
              # If set to 0, no traffic will be sent to that backend service.
              #weight:

          # Configures paths or headers to match against when sending traffic to
          # abackend service. Matches are independent, meaning the rule will
          # be matched if any matches below are true.
          #
          # If no matches are specified, all traffic will be sent to the "/"
          # path on the backend service pods by default.
          #matches:
          #  # Matches path "/path"
          #  - path: /path
          #
          #  # Header match. Contains a list of headers against which to match.
          #  - headers:
          #      - X-My-Header
          #      - X-Another-Header
          #
          #  # If a path and header specified in an entry, the rule will be
          #  # matched if BOTH the path and headers match.
          #  - path: /foo
          #    headers:
          #      - X-My-Header
          #      - X-Another-Header

          # Configures a path redirect. Overridden by "rewrite".
          #
          # Note: Enable or disable HTTP-to-HTTPS redirects using
          # "httpToHttpsRedirect" parameter in httpRoute definition above.
          #redirect:
          #  # Target path for redirect.
          #  path: /newpath
          #
          #  # Type can be "ReplaceFullPath" or "ReplacePrefixMatch".
          #  #
          #  # "ReplaceFullPath" will replace full paths specified in the
          #  # "matches" section with the one specified above.
          #  # Example: /path/to/endpoint -> /newpath
          #  #
          #  # "ReplacePrefixMatch" will replace the prefix specified in the
          #  # "matches" section with the one specified above.
          #  # Example: /path/to/endpoint -> /newpath/to/endpoint
          #  type: ReplaceFullPath
          #
          #  # HTTP status code to return. Default is 302.
          #  #statusCode: 302

          # Configures a rewrite. Overrides "redirect".
          #rewrite:
          #  hostname: chart.example2.local
          #
          #  # Optionally configure a path redirect when rewriting.
          #  #path:
          #  #  name: /newpath
          #  #
          #  #  # Type can be "ReplaceFullPath" or "ReplacePrefixMatch".
          #  #  #
          #  #  # "ReplaceFullPath" will replace full paths specified in the
          #  #  # "matches" section with the one specified above.
          #  #  # Example: /path/to/endpoint -> /newpath
          #  #  #
          #  #  # "ReplacePrefixMatch" will replace the prefix specified in the
          #  #  # "matches" section with the one specified above.
          #  #  # Example: /path/to/endpoint -> /newpath/to/endpoint
          #  #  type: ReplaceFullPath

# TODO: Create traffic distribution policies
# Defines how traffic is distributed across endpoints within a backend. This
# policy is similar to how you would configure specific traffic balancing
# algorithms for the backend service that are referenced by an Ingress resource.
trafficDistributionPolicies: []
