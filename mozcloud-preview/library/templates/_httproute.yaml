{{- define "mozcloud-preview-lib.httpRoute" -}}
{{- $rawRoutes := .httpRouteConfig.httpRoutes }}
{{- $previewHost := .previewHost }}
{{- $transformedRoutes := list }}

{{- range $route := $rawRoutes }}
  {{- $newHostnames := list }}

  {{- range $i, $hostname := $route.hostnames }}
    {{- $prefix := first (splitList "." (print $hostname)) }}
    {{- $prefixed := printf "%s-%s" $prefix $previewHost }}
    {{- $newHostnames = append $newHostnames $prefixed }}
  {{- end }}

  {{- $updatedRoute := mergeOverwrite (deepCopy $route) (dict "hostnames" $newHostnames) }}
  {{- $transformedRoutes = append $transformedRoutes $updatedRoute }}
{{- end }}

{{- $transformedConfig := dict "httpRoutes" $transformedRoutes }}

{{- include "mozcloud-gateway-lib.httpRoute" (mergeOverwrite . (dict "httpRouteConfig" $transformedConfig)) }}
{{- end }}
